<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150303" />
    <meta http-equiv="Content-Language" content="en" />
    <title>PokerFace &#x2013; </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>PokerFace <(◕___◕)></h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
            
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                          
      <li>
  
                          <a href="index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="https://raw.githubusercontent.com/pcafstockf/PokerFace/master/dist/PokerFace-0.9.0-dist.jar" class="externalLink" title="Download">
          <i class="none"></i>
        Download</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>Quick Start</a>
          </li>
                
      <li>
  
                          <a href="scripting.html" title="Scripting">
          <i class="none"></i>
        Scripting</a>
            </li>
                
      <li>
  
                          <a href="../PokerFace" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
                
      <li>
  
                          <a href="benchmarks.html" title="Benchmarks">
          <i class="none"></i>
        Benchmarks</a>
            </li>
                
      <li>
  
                          <a href="overview-dev.html" title="Dev Guide">
          <i class="none"></i>
        Dev Guide</a>
            </li>
                
      <li>
  
                          <a href="apidocs/index.html" title="Java Doc">
          <i class="none"></i>
        Java Doc</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                         <a href="http://www.bytelightning.com/" title="Foo" class="builtBy">
        <img class="builtBy"  alt="Foo" src="powered-by.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <p>This guide will give you a basic introduction to PokerFace and describes some simple tasks that can be accomplished with it.<br />This guide describes some simple tasks that can be accomplished with Pokerface.</p>
<div class="section">
<div class="section">
<h3><a name="Basic_Command_Line_Syntax"></a>Basic Command Line Syntax</h3>
<p>You could &#x2018;fire up&#x2019; a simple local reverse proxy with:</p>

<div class="source">
<div class="source">
<pre>java -jar PokerFace-{version}.jar -listen 127.0.0.1:8080 -target &quot;/*=http://stackoverflow.com&quot;
</pre></div></div>
<p>This tells PokerFace to listen for http connections on localhost port 8080 and to forward all requests over to our good friends at Stack Overflow which you can see by hitting <a class="externalLink" href="http://localhost:8080/">http://localhost:8080/</a></p></div>
<div class="section">
<h3><a name="Help"></a>Help</h3>
<p>Simple / common scenarios can be easily described via the command line, while more complex scenarios will require a configuration file. You can get a complete list of command line options with:</p>

<div class="source">
<div class="source">
<pre>java -jar PokerFace-{version}.jar -h
</pre></div></div></div>
<div class="section">
<h3><a name="Basic_Reverse_Proxy"></a>Basic Reverse Proxy</h3>
<p>Here is a possible real world setup that also illustrates the infamous <b>DocumentRoot</b> challenge (which you must be aware of when configuring any reverse proxy):</p>

<div class="source">
<div class="source">
<pre>java -jar PokerFace-{version}.jar -listen https=0.0.0.0:443 -target &quot;/public/*=https://new-hotness.mydomain.com&quot; -target &quot;/private/*=http://old-and-busted.mydomain.com/corp#8&quot;  -keystore serverkey.jks -keypass changeit
</pre></div></div>
<p>This would tell PokerFace to listen for https connections to port 443 on all interfaces (multiple <i>-listen</i> arguments are allowed). Requests beginning with <tt>/public/</tt> will be proxied to the server at <tt>new-hotness.mydomain.com</tt>. Requests beginning with <tt>/private/</tt> will be sent to the <tt>old-and-busted.mydomain.com</tt> server. All other requests will return a <tt>404</tt> (NOT_FOUND).</p>
<p>Assuming PokerFace is running on a machine named <tt>www.mydomain.com</tt>, lets walk through the <i>DocumentRoot</i> challenge.</p>
<div class="section">
<h4><a name="new-hotness"></a>new-hotness</h4>
<p>When PokerFace recieves a request for <tt>https://www.mydomain.com/public/foo/bar.html</tt>, it will make a proxy request to <tt>https://new-hotness.mydomain.com/public/foo/bar.html</tt>.<br />However, <b>if</b> bar.html contains an absolute link to /assets/my.css, then the browser will request <tt>https://www.mydomain.com/assets/my.css</tt>, and PokerFace will return a 404 response (since that does not start with either /public/* or /private/*).</p>
<p>Remember, this DocumentRoot challenge is faced by all reverse proxies. Fortunately, there are work-arounds to solve this problem:</p>

<ul>
  
<li>One way is to ensure your html uses relative paths (e.g. /public/foo/bar.html &#x2019;s link would be to ../assets/my.css).</li>
  
<li>Another way is to add an additional target to the configuration such as: <tt>-target &quot;/assets/*=https://new-hotness.mydomain.com&quot;</tt></li>
</ul></div>
<div class="section">
<h4><a name="old-and-busted"></a>old-and-busted</h4>
<p>You may notice the # (anchor) on the old-and-busted remote target. This tells PokerFace to strip the first #8 charachters off each request before sending it on to the target. Therefore, when it recieves a request for <tt>https://www.mydomain.com/private/bar/foo.html</tt>, it will make a proxy request to <tt>https://old-and-busted.mydomain.com/corp/bar/foo.html</tt>.</p></div>
<div class="section">
<h4><a name="Securing_https"></a>Securing https</h4>
<p>For a production server you will need a certificate signed by a well known CA. But for testing purposes, you can quickly create a self signed certificate with:</p>

<div class="source">
<div class="source">
<pre>$JAVA_HOME/bin/keytool -genkey -alias www.mydomain.com -keyalg RSA -keypass changeit -storepass changeit -keystore serverkey.jks
</pre></div></div></div>
<div class="section">
<h4><a name="Multi-port__alternate_certificates"></a>Multi-port / alternate certificates</h4>
<p>By default, PokerFace will select the appropriate certificate from the keystore based on the hostname on which the request was recieved. You can override this by prefixing the listen address with the certificate alias. So, <tt>-listen alt.mydomain.com=0.0.0.0:443</tt> will find the certificate with an alias of alt.mydomain.com in the keystore and present that as the https certificate.</p></div></div>
<div class="section">
<h3><a name="Logging"></a>Logging</h3>
<p>PokerFace supports many logging frameworks thanks to <a class="externalLink" href="http://www.slf4j.org">SLF4J</a>. By default it uses the standard java.util.logging framework built into the JDK. You can override this by specifying one of the SLF4J implementation modules first on the classpath. For example to use log4j, you would launch PokerFace with:</p>

<div class="source">
<div class="source">
<pre>java -classpath &quot;path/to/slf4j-log4j12.jar;path/to/PokerFace-{version}.jar&quot; com.bytelightning.opensource.pokerface.PokerFaceApp -config path/to/config.xml
</pre></div></div></div>
<div class="section">
<h3><a name="Additional_Command_Line_Options"></a>Additional Command Line Options</h3>

<ul>
  
<li>
<p><tt>-servercpu</tt> / <tt>-targetcpu</tt>: Controls the number of threads for incomming requests from the client, and outgoing requests to remote targets, respectively. Since PokerFace uses the Java NIO model, you do not need a high thread count. If you use these parameters it is recommended that you pass 2/3 the number of cpu cores in your system. Both of these options provide flexible specification modes:</p>
  
<ul>
    
<li>if &lt; 0: Use the actual number of physical cpu cores in the machine.</li>
    
<li>if &gt;= 1: Use this number (up to twice the number of physical cores).</li>
    
<li>if &gt; 0 and &lt; 1: This fraction multiplied by the number of physical cores (e.g. 0.66 would be 2/3 the cores).</li>
  </ul></li>
  
<li><tt>-trustany</tt>: Tells PokerFace to ignore any certificate errors that the target servers might generate (e.g. invalid hostname, etc.).</li>
  
<li><tt>-config</tt>: allows you to specify complex configurations for PokerFace using XML. For instance, you could specify everything except the certificate key password in an XML file and then pass the password on the command line. Documentation and comments should be as close as possible to their subject, so please see the heavily commented <a class="externalLink" href="https://raw.githubusercontent.com/pcafstockf/PokerFace/master/Samples/SampleConfig.xml">sample configuration file</a> which discusses all configurable options for PokerFace.</li>
  
<li><tt>-scripts</tt>, <tt>-watch</tt>, and <tt>-dynamicTargetScripting</tt> options are discussed in <a class="externalLink" href="http://pcafstockf.github.io/PokerFace/scripting.html">Scripting PokerFace</a>.</li>
</ul></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                        <p class="pull-right">Copyright &copy;                    2015
                      Frank Stock.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
